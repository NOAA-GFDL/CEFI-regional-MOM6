name: get_glorys_data-ci

on:
  push:
    branches: [ "fix/copernicusmarine" ]
  pull_request:
    branches: [ "fix/copernicusmarine" ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:        
    - name: Checkout
      uses: actions/checkout@v4
        
    - uses: conda-incubator/setup-miniconda@v3
      with:
        miniconda-version: "latest"

    - name: Install copernicusmarine
      run: |     
        conda env create --file tools/initial/copernicusmarine-env.yml
      
    - name: Test get_glorts_data.sh
      run: |    
        cd tools/initial
        pwd
        conda activate cmc
        ./get_glorys_data.sh -u ${{secrets.CMCID}} -p ${{secrets.CMCPASSWD}} -o "./" -x -100 -X -35 -y 0 -Y 60 -s "1993-01-01" -e "1993-01-01"
        [ ! -f "GLORYS_REANALYSIS_1993-01-01.nc" ] && echo "FATAL: GLORYS_REANALYSIS_1993-01-01.nc does not exist. Exiting." && exit 1
