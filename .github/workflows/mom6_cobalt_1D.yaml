name: mom6_obgc_1d

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-latest

    container:
      image: ghcr.io/noaa-gfdl/fms/fms-ci-rocky-gnu:13.2.0
      credentials:
        username: ${{ github.actor }}
        password: ${{ secrets.github_token }}
        
    env:
      PR_NUMBER: ${{ github.event.number }}

    steps:        
    - name: Checkout
      uses: actions/checkout@v4
      with:
        submodules: recursive
        
    - name: Build mom6-sis2-cobalt
      run: |
        echo "build mom6-sis2-cobalt ..."
        cd builds && linux-build.bash -m fms-ci-rocky -p gnu -t repro -f mom6sis2

    - name: Download 1d model dataset
      run: | 
       cd exps
       wget ftp.gfdl.noaa.gov:/pub/Yi-cheng.Teng/1d_datasets.tar.gz && tar -zxvf 1d_datasets.tar.gz && rm -rf 1d_datasets.tar.gz

    - name: Run 1D toy case
      run: | 
       cd exps/OM4.single_column.COBALT
       mpirun -np 1 ../../builds/build/fms-ci-rocky-gnu/ocean_ice/repro/MOM6SIS2

    - name: Check ref
      run: | 
       cd exps/OM4.single_column.COBALT
       cat ./ocean.stats
       

